<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TP5 - Application Météo</title>

  <link href="css/bootstrap.min.css" rel="stylesheet"/>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/weather-icons/2.0.10/css/weather-icons.min.css"/>

  <style>
    /* petits ajustements UI */
    body { padding-top: 2rem; }
    .card { box-shadow: 0 0 1em rgba(0,0,0,0.12); }
    .list-group a { cursor: pointer; text-decoration: none; color: inherit; }
    .wi { font-size: 1.6rem; vertical-align: middle; margin-right: .4rem; }
  </style>
</head>
<body>
  <div class="container" id="weatherApp">
    <h1 class="mb-3">TP5 — Application Météo</h1>

    <!-- Formulaire -->
    <form v-on:submit="addCity" class="mb-3">
      <div class="input-group">
        <input type="search"
               class="form-control"
               v-model="formCityName"
               placeholder="Nom d'une ville (ex : Paris)"
               aria-label="Search for..."
               required
               autofocus>
        <button class="btn btn-primary" type="submit">Go!</button>
      </div>
      <small class="text-muted">{{ formCityName.length }} car.</small>

      <div class="alert alert-danger mt-2" role="alert" v-if="messageForm != ''">
        {{ messageForm }}
      </div>
    </form>

    <!-- Boutons utiles -->
    <div class="mb-3">
      <button class="btn btn-outline-secondary me-2" v-on:click="clearCities">Effacer la liste</button>
      <button class="btn btn-outline-success" v-on:click="useMyPosition">Ma position</button>
    </div>

    <!-- Liste des villes -->
    <h4>Liste des villes ({{ cityList.length }})</h4>
    <ul class="list-group mb-3">
      <li v-for="city in cityList" :key="city.name"
          class="list-group-item d-flex justify-content-between align-items-center">
        <div @click="meteo(city)" style="flex:1">
          {{ city.name }}
        </div>
        <div>
          <button class="btn btn-sm btn-secondary me-2" v-on:click.stop="meteo(city)" title="Afficher la météo">☁️</button>
          <button class="btn btn-sm btn-danger" v-on:click.stop="remove(city)" title="Supprimer">×</button>
        </div>
      </li>
    </ul>

    <div class="alert alert-primary" role="alert" v-if="cityList.length == 0">
      Aucune ville de saisie!
    </div>

    <!-- Messages généraux -->
    <div class="alert alert-info" role="alert" v-if="message">{{ message }}</div>

    <!-- Chargement météo -->
    <div v-if="cityWeatherLoading" class="mb-3">Chargement de la météo...</div>

    <!-- Carte météo -->
    <div v-if="cityWeather" class="mb-3">
  <div class="card" style="max-width: 720px;">
    <div class="card-header d-flex justify-content-between align-items-center">
      <span>
        {{ cityWeather.name }} @{{ cityWheaterDate }}
      </span>
      <button class="btn btn-sm btn-outline-danger"
              v-on:click="closeWeather"
              title="Fermer la carte">
        &times;
      </button>
    </div>

        <!-- Iframe OpenStreetMap -->
        <iframe class="card-img-top"
                alt="Carte"
                width="100%"
                height="300"
                frameborder="0"
                scrolling="no"
                v-bind:src="'https://www.openstreetmap.org/export/embed.html?bbox='+openStreetMapArea+'&layer=mapnik&marker='+cityWeather.coord.lat+'%2C'+cityWeather.coord.lon">
        </iframe>

        <div class="card-body">
          <h5 class="card-title">
            <i v-bind:class="'wi wi-owm-day-'+cityWeather.weather[0].id"></i>
            {{ cityWeather.main.temp }} <i class="wi wi-celsius"></i>
          </h5>
          <p class="card-text text-capitalize">{{ cityWeather.weather[0].description }}</p>
        </div>

        <ul class="list-group list-group-flush">
          <li class="list-group-item"><i class="wi wi-cloud"></i> Nuage: {{ cityWeather.clouds.all }}%</li>
          <li class="list-group-item"><i class="wi wi-humidity"></i> Humidité: {{ cityWeather.main.humidity }}%</li>
          <li class="list-group-item"><i class="wi wi-strong-wind"></i> Vent: {{ cityWeather.wind.speed }} m/s</li>
          <li class="list-group-item"><i class="wi wi-sunrise"></i> Levé du soleil: {{ cityWheaterSunrise }}</li>
          <li class="list-group-item"><i class="wi wi-sunset"></i> Couché du soleil: {{ cityWheaterSunset }}</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Librairies JS -->
  <script src="js/libs/vue.js"></script>

  <!-- Bootstrap JS -->
  <script src="js/libs/bootstrap.bundle.min.js"></script>

  <!-- main.js -->
  <script src="js/main.js"></script>
</body>
</html>

